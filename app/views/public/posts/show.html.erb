<h2>投稿詳細</h2>

<p>
  <strong>投稿者：</strong>
  <%= link_to(@post.user&.name.presence || @post.user&.email, user_path(@post.user)) %>
</p>

<p><strong>出来事の日付：</strong> <%= @post.occurred_on %></p>
<p>
  <strong>本文：</strong>
  <%= simple_format(@post.body, {}, wrapper_tag: "span") %>
</p>

 <p>
    <strong>対象：</strong>
    <% if @post.profiles.any? %>
      <%= @post.profiles.map(&:name).join("・") %>
    <% else %>
       指定なし
    <% end %>
  </p>

  <p>
    <strong>タグ：</strong>
    <% if @post.tags.any? %>
      <% @post.tags.each do |tag| %>
        <%= link_to "##{tag.name}", posts_path(q: { tags_name_eq: tag.name }),
        class: "badge badge-warning mr-1 text-dark" %>
      <% end %>
    <% else %>
      <span class="text-muted" style="font-size: 0.9em;">
        このエピソードには、まだ性格タグがついていません。<br>
        文章がとても短い場合や、行動や気持ちが読み取りづらい内容のときは、
        AI による自動タグ付けが行われないことがあります。
      </span>
    <% end %>
  </p>

  <div class="mt-3">
    <div class="mt-3 d-flex align-items-center">
    <%= link_to "一覧に戻る", posts_path, class: "btn btn-secondary mr-2" %>

    <div class="btn-group" role="group">
      <% if can_edit_post?(@post) %>
        <%= link_to "編集", edit_post_path(@post), class: "btn btn-outline-primary mr-2" %>
      <% end %>

      <% if can_delete_post?(@post) %>
        <%= link_to "削除", post_path(@post),
              method: :delete,
              data: { confirm: "本当に削除しますか？" },
              class: "btn btn-outline-danger" %>
      <% end %>
    </div>
  </div>


  <hr id="comments" class="mt-4">

  <h3 class="mt-3">コメント</h3>

  <%# 一覧 %>
  <% @comments ||= @post.comments.includes(:user).order(created_at: :asc) %>
  <ul class="list-group mb-3">
    <% if @comments.any? %>
      <%= render partial: "public/comments/comment", collection: @comments, as: :comment, locals: { post: @post } %>
    <% else %>
      <li class="list-group-item text-muted">まだコメントはありません</li>
    <% end %>
  </ul>

  <%# フォーム（ログイン時のみ） %>
  <% if user_signed_in? %>
    <%= form_with model: [@post, Comment.new], local: true do |f| %>
      <div class="mb-3">
        <%= f.label :body, "コメント内容" %>
        <%= f.text_area :body, rows: 4, class: "form-control" %>
      </div>
      <%= f.submit "コメントする", class: "btn btn-primary" %>
    <% end %>
  <% else %>
    <p class="text-muted">コメントするにはログインしてください。</p>
  <% end %>
