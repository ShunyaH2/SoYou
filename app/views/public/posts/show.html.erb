<h2>投稿詳細</h2>
<p><strong>出来事の日付：</strong> <%= @post.occurred_on %></p>
<p><strong>本文：</strong><br><%= simple_format(@post.body) %></p>

<p>
    <strong>タグ：</strong>
    <% if @post.tags.any? %>
      <% @post.tags.each do |tag| %>
        <%= link_to "##{tag.name}", posts_path(q: { tags_name_eq: tag.name }),
        class: "badge badge-warning mr-1 text-dark" %>
      <% end %>
    <% else %>
      なし
    <% end %>
  </p>

<div class="mt-3">
  <%= link_to "一覧に戻る", posts_path, class: "btn btn-secondary" %>

  <% if @post.user.id == current_user.id %>
    <%= link_to "編集", edit_post_path(@post), class: "btn btn-outline-primary" %>
    <%= link_to "削除", post_path(@post),
      method: :delete,
      data: { confirm: "本当に削除しますか？" },
      class: "btn btn-outline-danger" %>
    <% end %>
  </div>

  <p>
    対象：
    <% if @post.profiles.any? %>
      <%= @post.profiles.map(&:name).join("・") %>
    <% else %>
       指定なし
    <% end %>
  </p>

  <hr id="comments" class="mt-4">

  <h3 class="mt-3">コメント</h3>

  <%# 一覧 %>
  <% @comments ||= @post.comments.includes(:user).order(created_at: :asc) %>
  <ul class="list-group mb-3">
    <% if @comments.any? %>
      <%= render partial: "public/comments/comment", collection: @comments, as: :comment, locals: { post: @post } %>
    <% else %>
      <li class="list-group-item text-muted">まだコメントはありません</li>
    <% end %>
  </ul>

  <%# フォーム（ログイン時のみ） %>
  <% if user_signed_in? %>
    <%= form_with model: [@post, Comment.new], local: true do |f| %>
      <div class="mb-3">
        <%= f.label :body, "コメント内容" %>
        <%= f.text_area :body, rows: 4, class: "form-control" %>
      </div>
      <%= f.submit "コメントする", class: "btn btn-primary" %>
    <% end %>
  <% else %>
    <p class="text-muted">コメントするにはログインしてください。</p>
  <% end %>
