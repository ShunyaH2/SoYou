<div class="container mt-4">

  <h1 class="mb-4 text-center">
    <%= (@user.name || @user.email) %>さんのページ
  </h1>

<% if current_user == @user %>
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">
        <i class="fas fa-users mr-2 text-primary"></i>ファミリー情報
      </h5>

    <% if @user.family.present? %>
      <p class="mb-2">
        <strong>ファミリー名：</strong>
        <span class="text-dark"><%= @user.family.name %></span>
      </p>

      <p class="mb-1">
        <strong>ファミリーコード：</strong>
        <code class="text-monospace font-weight-bold"><%= @user.family.code %></code>
      </p>

      <small class="text-muted">
        （このコードを家族に共有すると同じファミリーに参加できます）
      </small>
    <% else %>
      <p class="text-danger mb-0">ファミリーが未設定です。</P>
    <% end %>
  </div>
<% end %>

<div class="card shadow-sm mb-2">
  <div class="card-body">
    <h5 class="card-title mb-3">
      <i class="fas fa-user mr2 text-primary"></i>プロフィール情報
    </h5>
    <p class="mb-0">
      <% if @user.profile&.image&.attached? %>
        <% if @user.profile.image.variable? %>
          <%= image_tag @user.profile.image.variant(resize_to_limit: [100, 100]) %>
        <% else %>
          <%= image_tag url_for(@user.profile.image) %> 
        <% end %>
        <% else %>
        <%= image_tag 'no_image.jpg' %>
      <% end %>
      <p class="mb-2">
        <strong>誕生日: </strong>
        <%= @user.profile&.birthday.present? ? @user.profile.birthday.strftime("%Y年%m月%d日") : "未登録" %>
      </p>   
    </P>
  </div>
</div>

<div class="actions mt-3 d-flex justify-content-center">
  <% if current_user == @user %>
    <%= link_to "プロフィール編集", edit_user_path(@user),
                class: "btn btn-primary mr-2" %>

    <%= link_to "家族管理へ", family_path, class: "btn btn-outline-primary mr-2" %>

    <%= button_to "退会（論理削除）",
                  withdraw_user_path(@user),
                  method: :patch,
                  data: { confirm: "本当に退会しますか？この操作は取り消せません。" },
                  form: { class: "d-inline" },
                  class: "btn btn-danger" %>
  <% end %>
</div>

<hr>
<h2>あなたの投稿一覧</h2>
<%= render "public/posts/table", posts: @posts, empty_message: "まだ投稿がありません。" %>